<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>OpenTelemetry with Java: Part 3 - Adding Custom Instrumentation | A Dev Writes</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="OpenTelemetry with Java: Part 3 - Adding Custom Instrumentation" />
<meta name="author" content="Laxman Sharma" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Enrich your auto-instrumentation with custom spans, business attributes, and events. Learn when and how to add manual instrumentation for better debugging." />
<meta property="og:description" content="Enrich your auto-instrumentation with custom spans, business attributes, and events. Learn when and how to add manual instrumentation for better debugging." />
<link rel="canonical" href="http://localhost:4000/2026/01/10/opentelemetry-java-part-3-custom-instrumentation/" />
<meta property="og:url" content="http://localhost:4000/2026/01/10/opentelemetry-java-part-3-custom-instrumentation/" />
<meta property="og:site_name" content="A Dev Writes" />
<meta property="og:image" content="http://localhost:4000/assets/images/otel-part3-hero.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2026-01-10T00:00:00+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/images/otel-part3-hero.png" />
<meta property="twitter:title" content="OpenTelemetry with Java: Part 3 - Adding Custom Instrumentation" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Laxman Sharma"},"dateModified":"2026-01-10T00:00:00+08:00","datePublished":"2026-01-10T00:00:00+08:00","description":"Enrich your auto-instrumentation with custom spans, business attributes, and events. Learn when and how to add manual instrumentation for better debugging.","headline":"OpenTelemetry with Java: Part 3 - Adding Custom Instrumentation","image":"http://localhost:4000/assets/images/otel-part3-hero.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2026/01/10/opentelemetry-java-part-3-custom-instrumentation/"},"url":"http://localhost:4000/2026/01/10/opentelemetry-java-part-3-custom-instrumentation/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/main.css">
    <link rel="alternate" type="application/rss+xml" title="A Dev Writes"
        href="/feed.xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="progress-bar" id="progress-bar"></div>

    <header class="site-header">
        <div class="header-wrapper">
            <a class="site-title" href="/">A Dev Writes</a>
            <nav class="site-nav">
                <a href="/" class="nav-link">Home</a>
                <a href="/about" class="nav-link">About</a>
            </nav>
        </div>
    </header>

    <main class="page-content">
        <div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    
    <div class="hero-image-container">
      <img src="/assets/images/otel-part3-hero.png" alt="OpenTelemetry with Java: Part 3 - Adding Custom Instrumentation" class="hero-image">
    </div>
    

    <h1 class="post-title p-name" itemprop="name headline">OpenTelemetry with Java: Part 3 - Adding Custom Instrumentation</h1>

    <div class="post-meta">
      <div class="author-info">
        <div class="author-avatar">
          <span>L</span>
        </div>
        <div class="author-details">
          <span class="author-name">Laxman Sharma</span>
          <time class="dt-published" datetime="2026-01-10T00:00:00+08:00" itemprop="datePublished">
            January 10, 2026
          </time>
        </div>
      </div>

      
      <div class="post-tags">
        
        <a href="/tags/#opentelemetry" class="tag">opentelemetry</a>
        
        <a href="/tags/#manual-instrumentation" class="tag">manual-instrumentation</a>
        
        <a href="/tags/#spring-boot" class="tag">spring-boot</a>
        
        <a href="/tags/#annotations" class="tag">annotations</a>
        
      </div>
      
    </div>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h1 id="adding-custom-instrumentation">Adding Custom Instrumentation</h1>

<p><em>Part 3 of a 6-part series on implementing observability in Java microservices</em></p>

<hr />

<p>In <a href="/2026/01/09/opentelemetry-java-part-2-zero-to-tracing/">Part 2</a>, we got distributed tracing working with zero code changes. But the auto-generated spans are generic: <code class="language-plaintext highlighter-rouge">POST /orders</code>, <code class="language-plaintext highlighter-rouge">GET /inventory</code>.</p>

<p>When debugging production issues, you need <strong>business context</strong>: <em>Which order failed? Which customer? What was the payment amount?</em></p>

<p>That’s where manual instrumentation comes in.</p>

<h2 id="when-auto-instrumentation-isnt-enough">When Auto-Instrumentation Isn’t Enough</h2>

<p>Auto-instrumentation is fantastic for:</p>
<ul>
  <li>HTTP requests/responses</li>
  <li>Database query timing</li>
  <li>Message queue operations</li>
</ul>

<p>But it <strong>doesn’t know</strong> about your business logic:</p>
<ul>
  <li>Order IDs, customer IDs, SKUs</li>
  <li>Business validation steps</li>
  <li>Internal processing phases</li>
  <li>Custom error contexts</li>
</ul>

<h2 id="adding-the-otel-sdk-dependency">Adding the OTel SDK Dependency</h2>

<p>First, add the OpenTelemetry SDK to your project:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Maven --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.opentelemetry.instrumentation<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>opentelemetry-instrumentation-annotations<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.1.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Gradle</span>
<span class="n">implementation</span> <span class="s1">'io.opentelemetry.instrumentation:opentelemetry-instrumentation-annotations:2.1.0'</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>: When using the Java Agent, you don’t need the full SDK—just the annotations library. The agent provides the runtime.</p>
</blockquote>

<h2 id="method-1-withspan-annotation-easiest">Method 1: @WithSpan Annotation (Easiest)</h2>

<p>The simplest way to add custom spans is with the <code class="language-plaintext highlighter-rouge">@WithSpan</code> annotation:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">io.opentelemetry.instrumentation.annotations.WithSpan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.opentelemetry.instrumentation.annotations.SpanAttribute</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderService</span> <span class="o">{</span>
    
    <span class="nd">@WithSpan</span><span class="o">(</span><span class="s">"process-order"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Order</span> <span class="nf">processOrder</span><span class="o">(</span>
            <span class="nd">@SpanAttribute</span><span class="o">(</span><span class="s">"order.customer_id"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">customerId</span><span class="o">,</span>
            <span class="nd">@SpanAttribute</span><span class="o">(</span><span class="s">"order.amount"</span><span class="o">)</span> <span class="nc">BigDecimal</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        
        <span class="n">validateOrder</span><span class="o">(</span><span class="n">customerId</span><span class="o">,</span> <span class="n">amount</span><span class="o">);</span>
        <span class="nc">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">createOrder</span><span class="o">(</span><span class="n">customerId</span><span class="o">,</span> <span class="n">amount</span><span class="o">);</span>
        <span class="n">sendConfirmation</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        
        <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@WithSpan</span><span class="o">(</span><span class="s">"validate-order"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">validateOrder</span><span class="o">(</span><span class="nc">String</span> <span class="n">customerId</span><span class="o">,</span> <span class="nc">BigDecimal</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Validation logic</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">amount</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="nc">BigDecimal</span><span class="o">.</span><span class="na">ZERO</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOrderException</span><span class="o">(</span><span class="s">"Amount must be positive"</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now your trace shows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /orders
└── process-order [customer_id: "cust-123", amount: 99.99]
    └── validate-order
</code></pre></div></div>

<h2 id="method-2-programmatic-spans-full-control">Method 2: Programmatic Spans (Full Control)</h2>

<p>For more control, create spans programmatically:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">io.opentelemetry.api.GlobalOpenTelemetry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.opentelemetry.api.trace.Span</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.opentelemetry.api.trace.Tracer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.opentelemetry.context.Scope</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentService</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Tracer</span> <span class="n">tracer</span> <span class="o">=</span> <span class="nc">GlobalOpenTelemetry</span><span class="o">.</span><span class="na">getTracer</span><span class="o">(</span><span class="s">"payment-service"</span><span class="o">);</span>
    
    <span class="kd">public</span> <span class="nc">PaymentResult</span> <span class="nf">processPayment</span><span class="o">(</span><span class="nc">String</span> <span class="n">orderId</span><span class="o">,</span> <span class="nc">BigDecimal</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Span</span> <span class="n">span</span> <span class="o">=</span> <span class="n">tracer</span><span class="o">.</span><span class="na">spanBuilder</span><span class="o">(</span><span class="s">"process-payment"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"order.id"</span><span class="o">,</span> <span class="n">orderId</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"payment.amount"</span><span class="o">,</span> <span class="n">amount</span><span class="o">.</span><span class="na">doubleValue</span><span class="o">())</span>
            <span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"payment.currency"</span><span class="o">,</span> <span class="s">"USD"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">startSpan</span><span class="o">();</span>
        
        <span class="k">try</span> <span class="o">(</span><span class="nc">Scope</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="na">makeCurrent</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// Your payment logic</span>
            <span class="nc">PaymentResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">callPaymentGateway</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
            
            <span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"payment.transaction_id"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getTransactionId</span><span class="o">());</span>
            <span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"payment.status"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">getStatus</span><span class="o">());</span>
            
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
            
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">PaymentException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">span</span><span class="o">.</span><span class="na">recordException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="n">span</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">StatusCode</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
            
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">span</span><span class="o">.</span><span class="na">end</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="adding-events-to-spans">Adding Events to Spans</h2>

<p>Events are timestamped annotations within a span—perfect for marking checkpoints:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WithSpan</span><span class="o">(</span><span class="s">"process-order"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Order</span> <span class="nf">processOrder</span><span class="o">(</span><span class="nc">OrderRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Span</span> <span class="n">currentSpan</span> <span class="o">=</span> <span class="nc">Span</span><span class="o">.</span><span class="na">current</span><span class="o">();</span>
    
    <span class="c1">// Mark validation complete</span>
    <span class="n">currentSpan</span><span class="o">.</span><span class="na">addEvent</span><span class="o">(</span><span class="s">"order.validated"</span><span class="o">,</span> <span class="nc">Attributes</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="nc">AttributeKey</span><span class="o">.</span><span class="na">stringKey</span><span class="o">(</span><span class="s">"validation.result"</span><span class="o">),</span> <span class="s">"passed"</span>
    <span class="o">));</span>
    
    <span class="c1">// Mark inventory reserved</span>
    <span class="n">reserveInventory</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getSku</span><span class="o">());</span>
    <span class="n">currentSpan</span><span class="o">.</span><span class="na">addEvent</span><span class="o">(</span><span class="s">"inventory.reserved"</span><span class="o">);</span>
    
    <span class="c1">// Mark payment processed</span>
    <span class="n">processPayment</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="n">currentSpan</span><span class="o">.</span><span class="na">addEvent</span><span class="o">(</span><span class="s">"payment.processed"</span><span class="o">,</span> <span class="nc">Attributes</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="nc">AttributeKey</span><span class="o">.</span><span class="na">stringKey</span><span class="o">(</span><span class="s">"payment.method"</span><span class="o">),</span> <span class="n">request</span><span class="o">.</span><span class="na">getPaymentMethod</span><span class="o">()</span>
    <span class="o">));</span>
    
    <span class="k">return</span> <span class="nf">createOrder</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In Jaeger, you’ll see these events as markers on the span timeline.</p>

<h2 id="recording-exceptions">Recording Exceptions</h2>

<p>Always record exceptions for debugging:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
    <span class="n">riskyOperation</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Span</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">recordException</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="nc">Attributes</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
        <span class="nc">AttributeKey</span><span class="o">.</span><span class="na">stringKey</span><span class="o">(</span><span class="s">"exception.context"</span><span class="o">),</span> <span class="s">"During inventory check"</span>
    <span class="o">));</span>
    <span class="nc">Span</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">StatusCode</span><span class="o">.</span><span class="na">ERROR</span><span class="o">,</span> <span class="s">"Inventory check failed"</span><span class="o">);</span>
    <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This adds the full stack trace to your span, visible in Jaeger.</p>

<h2 id="best-practices">Best Practices</h2>

<h3 id="1-use-semantic-conventions">1. Use Semantic Conventions</h3>

<p>OpenTelemetry defines standard attribute names. Use them:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Good - follows semantic conventions</span>
<span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"http.request.method"</span><span class="o">,</span> <span class="s">"POST"</span><span class="o">);</span>
<span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"db.system"</span><span class="o">,</span> <span class="s">"postgresql"</span><span class="o">);</span>
<span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"messaging.system"</span><span class="o">,</span> <span class="s">"kafka"</span><span class="o">);</span>

<span class="c1">// Avoid - custom names that aren't standard</span>
<span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"method"</span><span class="o">,</span> <span class="s">"POST"</span><span class="o">);</span>
<span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"database"</span><span class="o">,</span> <span class="s">"postgresql"</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="2-mind-your-span-names">2. Mind Your Span Names</h3>

<p>Span names should be <strong>low-cardinality</strong>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Good - fixed name</span>
<span class="n">tracer</span><span class="o">.</span><span class="na">spanBuilder</span><span class="o">(</span><span class="s">"get-order-by-id"</span><span class="o">)</span>

<span class="c1">// Bad - high cardinality (includes variable data)</span>
<span class="n">tracer</span><span class="o">.</span><span class="na">spanBuilder</span><span class="o">(</span><span class="s">"get-order-"</span> <span class="o">+</span> <span class="n">orderId</span><span class="o">)</span>
</code></pre></div></div>

<p>Put variable data in <strong>attributes</strong>, not span names.</p>

<h3 id="3-dont-over-instrument">3. Don’t Over-Instrument</h3>

<p>Every span has overhead. Focus on:</p>
<ul>
  <li>Business operations (not every helper method)</li>
  <li>External calls (APIs, databases)</li>
  <li>Long-running processes</li>
  <li>Error-prone code paths</li>
</ul>

<h3 id="4-add-context-not-noise">4. Add Context, Not Noise</h3>

<p>Good attributes help debugging:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"order.id"</span><span class="o">,</span> <span class="n">orderId</span><span class="o">);</span>
<span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"order.item_count"</span><span class="o">,</span> <span class="n">items</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"customer.tier"</span><span class="o">,</span> <span class="n">customer</span><span class="o">.</span><span class="na">getTier</span><span class="o">());</span>
</code></pre></div></div>

<p>Avoid sensitive data (PII, passwords, tokens).</p>

<h2 id="complete-example-order-processing">Complete Example: Order Processing</h2>

<p>Here’s a realistic example combining all techniques:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderService</span> <span class="o">{</span>
    
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Tracer</span> <span class="n">tracer</span> <span class="o">=</span> <span class="nc">GlobalOpenTelemetry</span><span class="o">.</span><span class="na">getTracer</span><span class="o">(</span><span class="s">"order-service"</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">InventoryClient</span> <span class="n">inventoryClient</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PaymentClient</span> <span class="n">paymentClient</span><span class="o">;</span>
    
    <span class="nd">@WithSpan</span><span class="o">(</span><span class="s">"create-order"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Order</span> <span class="nf">createOrder</span><span class="o">(</span>
            <span class="nd">@SpanAttribute</span><span class="o">(</span><span class="s">"order.customer_id"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">customerId</span><span class="o">,</span>
            <span class="nd">@SpanAttribute</span><span class="o">(</span><span class="s">"order.sku"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">sku</span><span class="o">,</span>
            <span class="nd">@SpanAttribute</span><span class="o">(</span><span class="s">"order.quantity"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
        
        <span class="nc">Span</span> <span class="n">span</span> <span class="o">=</span> <span class="nc">Span</span><span class="o">.</span><span class="na">current</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">orderId</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"order.id"</span><span class="o">,</span> <span class="n">orderId</span><span class="o">);</span>
        
        <span class="c1">// Check inventory</span>
        <span class="n">checkInventory</span><span class="o">(</span><span class="n">sku</span><span class="o">,</span> <span class="n">quantity</span><span class="o">);</span>
        <span class="n">span</span><span class="o">.</span><span class="na">addEvent</span><span class="o">(</span><span class="s">"inventory.checked"</span><span class="o">);</span>
        
        <span class="c1">// Calculate pricing</span>
        <span class="nc">BigDecimal</span> <span class="n">total</span> <span class="o">=</span> <span class="n">calculateTotal</span><span class="o">(</span><span class="n">sku</span><span class="o">,</span> <span class="n">quantity</span><span class="o">);</span>
        <span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"order.total"</span><span class="o">,</span> <span class="n">total</span><span class="o">.</span><span class="na">doubleValue</span><span class="o">());</span>
        
        <span class="c1">// Process payment</span>
        <span class="nc">String</span> <span class="n">paymentId</span> <span class="o">=</span> <span class="n">processPayment</span><span class="o">(</span><span class="n">customerId</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"payment.id"</span><span class="o">,</span> <span class="n">paymentId</span><span class="o">);</span>
        <span class="n">span</span><span class="o">.</span><span class="na">addEvent</span><span class="o">(</span><span class="s">"payment.completed"</span><span class="o">);</span>
        
        <span class="c1">// Save order</span>
        <span class="nc">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">saveOrder</span><span class="o">(</span><span class="n">orderId</span><span class="o">,</span> <span class="n">customerId</span><span class="o">,</span> <span class="n">sku</span><span class="o">,</span> <span class="n">quantity</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
        <span class="n">span</span><span class="o">.</span><span class="na">addEvent</span><span class="o">(</span><span class="s">"order.saved"</span><span class="o">);</span>
        
        <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">checkInventory</span><span class="o">(</span><span class="nc">String</span> <span class="n">sku</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Span</span> <span class="n">span</span> <span class="o">=</span> <span class="n">tracer</span><span class="o">.</span><span class="na">spanBuilder</span><span class="o">(</span><span class="s">"check-inventory"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"inventory.sku"</span><span class="o">,</span> <span class="n">sku</span><span class="o">)</span>
            <span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"inventory.quantity_requested"</span><span class="o">,</span> <span class="n">quantity</span><span class="o">)</span>
            <span class="o">.</span><span class="na">startSpan</span><span class="o">();</span>
        
        <span class="k">try</span> <span class="o">(</span><span class="nc">Scope</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">span</span><span class="o">.</span><span class="na">makeCurrent</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">boolean</span> <span class="n">available</span> <span class="o">=</span> <span class="n">inventoryClient</span><span class="o">.</span><span class="na">check</span><span class="o">(</span><span class="n">sku</span><span class="o">,</span> <span class="n">quantity</span><span class="o">);</span>
            <span class="n">span</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"inventory.available"</span><span class="o">,</span> <span class="n">available</span><span class="o">);</span>
            
            <span class="k">if</span> <span class="o">(!</span><span class="n">available</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InsufficientInventoryException</span><span class="o">(</span><span class="n">sku</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">span</span><span class="o">.</span><span class="na">recordException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
            <span class="n">span</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">StatusCode</span><span class="o">.</span><span class="na">ERROR</span><span class="o">);</span>
            <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">span</span><span class="o">.</span><span class="na">end</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="whats-next">What’s Next</h2>

<p>You now have rich, contextual traces. But observability is more than tracing.</p>

<p>In <strong>Part 4</strong>, we’ll add <strong>custom metrics</strong>:</p>
<ul>
  <li>Request counters</li>
  <li>Latency histograms</li>
  <li>Business gauges (orders per minute, active users)</li>
</ul>

<p>We’ll export to Prometheus and build dashboards in Grafana.</p>

<hr />

<p><em>Previous: <a href="/2026/01/09/opentelemetry-java-part-2-zero-to-tracing/">Part 2 - Zero to Tracing</a></em></p>

<p><em>Next: <a href="/2026/01/11/opentelemetry-java-part-4-metrics/">Part 4 - Metrics That Matter</a></em></p>

<hr />

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://opentelemetry.io/docs/languages/java/automatic/annotations/">OTel Instrumentation Annotations</a></li>
  <li><a href="https://opentelemetry.io/docs/concepts/semantic-conventions/">Semantic Conventions</a></li>
  <li><a href="https://opentelemetry.io/docs/languages/java/api/">Span API Reference</a></li>
</ul>

  </div>

  <footer class="post-footer">
    <div class="post-nav">
      
      <a href="/2026/01/09/opentelemetry-java-part-2-zero-to-tracing/" class="nav-link prev">
        <span class="nav-label">← Previous</span>
        <span class="nav-title">OpenTelemetry with Java: Part 2 - Zero to Tracing in 15 Minutes</span>
      </a>
      
      
      <a href="/2026/01/11/opentelemetry-java-part-4-metrics/" class="nav-link next">
        <span class="nav-label">Next →</span>
        <span class="nav-title">OpenTelemetry with Java: Part 4 - Metrics That Matter</span>
      </a>
      
    </div>
  </footer>
</article>
        </div>
    </main>

    <footer class="site-footer">
        <div class="footer-wrapper">
            <p>&copy; 2026 {"name" => "Laxman Sharma"}. All rights reserved.</p>
            <div class="social-links">
                <a href="https://github.com/laxman-sharma" target="_blank" rel="noopener noreferrer">GitHub</a>
                <a href="https://www.linkedin.com/in/laxman-sharma-328b2659" target="_blank"
                    rel="noopener noreferrer">LinkedIn</a>
                <a href="https://www.toptal.com/resume/laxman-sharma" target="_blank"
                    rel="noopener noreferrer">Toptal</a>
            </div>
        </div>
    </footer>

    <script>
        // Reading progress bar
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progress-bar').style.width = scrolled + '%';
        });
    </script>
</body>

</html>